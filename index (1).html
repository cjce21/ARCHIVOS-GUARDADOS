<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoo-L√≥gica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: #ffffff; /* Fondo blanco */
            transition: box-shadow 0.2s ease-in-out;
        }
        
        #game-area {
            perspective: 1000px;
        }

        /* Estilo del mazo de cartas */
        .card-stack {
            position: relative;
            width: 224px; /* Ancho base para m√≥viles */
            height: 308px; /* Alto base para m√≥viles */
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .card-stack {
                width: 256px;
                height: 352px;
            }
        }
        .card-stack:hover {
            transform: scale(1.05) rotate(3deg);
        }
        .card-stack-item {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 1.5rem;
            background-color: white;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border: 2px solid #1a202c; /* Borde negro */
            transition: transform 0.3s ease;
        }
        .card-stack-item:nth-child(1) { transform: rotate(-8deg); }
        .card-stack-item:nth-child(2) { transform: rotate(-2deg); }
        .card-stack-item:nth-child(3) { transform: rotate(4deg); }

        /* Animaci√≥n de giro de la carta */
        .card-container {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .card-container.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 1.5rem;
        }
        .card-back {
            transform: rotateY(180deg);
            padding: 1rem;
            border: 2px solid #1a202c; /* Borde negro a√±adido */
        }
        
        /* Animaci√≥n del temporizador */
        @keyframes timer-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); color: #dc2626; }
        }
        .timer-warning {
            animation: timer-pulse 1s infinite;
        }
        .modal-enter {
            animation: modal-enter-animation 0.3s ease-out forwards;
        }
        @keyframes modal-enter-animation {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        /* Animaci√≥n de mazo agitado por tiempo agotado */
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0) rotate(3deg); }
            20%, 80% { transform: translate3d(2px, 0, 0) rotate(-3deg); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0) rotate(3deg); }
            40%, 60% { transform: translate3d(4px, 0, 0) rotate(-3deg); }
        }
        .animate-shake {
            animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both;
        }
    </style>
</head>
<body class="flex items-center justify-center h-screen overflow-hidden">

    <div id="app-container" class="w-full max-w-2xl mx-auto text-center p-4">

        <!-- Pantalla de Inicio --><div id="start-screen" class="hidden relative flex flex-col justify-center min-h-[500px]">
            <div>
                <h1 class="text-4xl md:text-5xl font-black text-black mb-8 uppercase tracking-wider">Zoo-L√≥gica</h1>
                <div class="grid grid-cols-1 gap-4 max-w-sm mx-auto">
                    <button id="start-button" class="bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-xl hover:bg-green-700 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 text-lg">
                        Nueva Partida
                    </button>
                    <button id="continue-button" class="hidden bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-xl hover:bg-green-700 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 text-lg">
                        Continuar Partida
                    </button>
                    <button id="grades-button" class="bg-gray-500 text-white font-bold py-3 px-8 rounded-full shadow-xl hover:bg-gray-600 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300 text-lg disabled:opacity-50 disabled:cursor-not-allowed">
                        Ver Calificaciones
                    </button>
                </div>
            </div>
             <p class="text-sm text-gray-500 mt-12 absolute bottom-0 w-full left-0">
                ¬© 2025 Zoo-L√≥gica | Desarrollado por Didac-Click Group.
            </p>
        </div>
        
        <!-- Pantalla de Calificaciones --><div id="grades-screen" class="hidden">
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-3xl font-black text-black mb-6">Reporte de Calificaci√≥n</h2>
                <div id="grades-content" class="space-y-4 md:grid md:grid-cols-2 md:gap-x-8 md:gap-y-6 md:space-y-0 text-left"></div>
                 <button id="back-to-start-button" class="mt-8 bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-xl hover:bg-green-700 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 text-lg">
                    Volver
                </button>
            </div>
        </div>

        <!-- Pantalla de Juego --><div id="game-screen" class="hidden">
            <div class="flex justify-between items-center mb-4 px-2">
                <button id="home-button" class="text-gray-600 hover:text-green-600 transition-colors p-2 rounded-full hover:bg-gray-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                </button>
                <div id="progress-display" class="text-lg sm:text-2xl font-bold text-gray-700"></div>
                <div id="timer-display" class="w-16 text-center text-3xl sm:text-4xl font-black text-green-600">10</div>
            </div>
            
            <div id="game-area" class="relative h-80 sm:h-96 flex items-center justify-center">
                <div id="played-cards-stack" class="hidden card-stack absolute">
                    <div class="card-stack-item bg-white" style="transform: rotate(5deg);"></div>
                    <div class="card-stack-item bg-white" style="transform: rotate(-3deg);"></div>
                </div>
                <div id="deck" class="card-stack">
                    <div class="card-stack-item"></div>
                    <div class="card-stack-item"></div>
                    <div class="card-stack-item bg-white flex flex-col items-center justify-center p-2 overflow-hidden">
                         <img id="deck-image" src="https://i.supaimg.com/37ef4026-991a-42e1-afa0-b2db1a21237f.jpg" alt="Reverso de la carta" class="w-full h-full object-cover rounded-xl">
                    </div>
                </div>
                <div id="current-card-container" class="hidden w-56 h-72 sm:w-64 sm:h-80">
                    <div class="card-container w-full h-full">
                        <div class="card-face card-front bg-green-600"></div>
                        <div class="card-face card-back bg-white shadow-2xl"></div>
                    </div>
                </div>
            </div>

            <div id="options-container" class="mt-6 grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-4">
                <button data-type="Carn√≠voro" class="option-button bg-red-500 text-white font-bold py-3 sm:py-4 rounded-xl shadow-lg hover:bg-red-600 transition-all transform hover:scale-105 disabled:opacity-50">Carn√≠voro</button>
                <button data-type="Herb√≠voro" class="option-button bg-blue-500 text-white font-bold py-3 sm:py-4 rounded-xl shadow-lg hover:bg-blue-600 transition-all transform hover:scale-105 disabled:opacity-50">Herb√≠voro</button>
                <button data-type="Omn√≠voro" class="option-button bg-yellow-500 text-white font-bold py-3 sm:py-4 rounded-xl shadow-lg hover:bg-yellow-600 transition-all transform hover:scale-105 disabled:opacity-50">Omn√≠voro</button>
            </div>
            <div id="definition-display" class="mt-4 h-12 text-base sm:text-lg text-gray-700 font-medium transition-opacity duration-500"></div>
        </div>
    </div>
    
    <!-- Modales --><div id="modal-overlay" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <!-- Modal de Bienvenida --><div id="explanation-modal" class="hidden bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full text-center modal-enter">
            <h2 class="text-2xl font-black text-black mb-4 whitespace-nowrap">¬°Bienvenido a Zoo-L√≥gica!</h2>
            <p class="text-black mb-6">
                Tu objetivo es clasificar el r√©gimen alimenticio de distintas especies. Dispones de 10 segundos por cada animal para demostrar cu√°nto sabes. ¬°Mucha suerte!
            </p>
            <button id="understood-button" class="w-full bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-xl hover:bg-green-700 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 text-lg">
                Entendido
            </button>
        </div>

        <!-- Modal de Feedback --><div id="feedback-modal" class="hidden bg-white p-6 rounded-2xl shadow-2xl max-w-md w-full text-center modal-enter">
             <div id="feedback-image" class="text-8xl mb-4"></div>
             <h2 id="feedback-title" class="text-3xl font-black mb-2"></h2>
             <p id="feedback-text" class="text-black text-left mb-6"></p>
             <button id="feedback-continue-button" class="w-full bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-xl hover:bg-green-700 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 text-lg">
                Continuar
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const animals = [
                // Carn√≠voros (34)
                { name: 'Le√≥n', type: 'Carn√≠voro', emoji: 'ü¶Å', description: 'El le√≥n es un superdepredador cuya dieta se basa en la carne de animales que caza, como cebras y √±us.'},
                { name: 'Tigre', type: 'Carn√≠voro', emoji: 'üêÖ', description: 'Como cazador solitario, el tigre se alimenta de grandes presas como ciervos y jabal√≠es.'},
                { name: 'Lobo', type: 'Carn√≠voro', emoji: 'üê∫', description: 'Los lobos cazan en manada para derribar presas grandes como alces y ciervos.'},
                { name: 'Tibur√≥n', type: 'Carn√≠voro', emoji: 'ü¶à', description: 'Se alimenta de peces, focas y mam√≠feros marinos, situ√°ndose en la cima de la cadena alimenticia.'},
                { name: '√Åguila', type: 'Carn√≠voro', emoji: 'ü¶Ö', description: 'Esta ave rapaz utiliza su aguda vista y garras para cazar peces, roedores y serpientes.'},
                { name: 'Cocodrilo', type: 'Carn√≠voro', emoji: 'üêä', description: 'Depredador de emboscada, se alimenta de peces, aves y mam√≠feros que se acercan al agua.'},
                { name: 'Ara√±a', type: 'Carn√≠voro', emoji: 'üï∑Ô∏è', description: 'Las ara√±as son depredadores de insectos y otros peque√±os invertebrados que atrapan en sus telara√±as.'},
                { name: 'Serpiente', type: 'Carn√≠voro', emoji: 'üêç', description: 'Ingieren a sus presas enteras, que pueden ser desde peque√±os roedores hasta animales m√°s grandes.'},
                { name: 'Guepardo', type: 'Carn√≠voro', emoji: 'üêÜ', description: 'Conocido por su incre√≠ble velocidad, caza mam√≠feros de tama√±o mediano como gacelas.'},
                { name: 'Oso Polar', type: 'Carn√≠voro', emoji: 'üêª‚Äç‚ùÑÔ∏è', description: 'Su dieta se basa principalmente en focas, que caza en el hielo marino del √Årtico.'},
                { name: 'B√∫ho', type: 'Carn√≠voro', emoji: 'ü¶â', description: 'Cazador nocturno, se alimenta de roedores, insectos y otras aves peque√±as.'},
                { name: 'Pira√±a', type: 'Carn√≠voro', emoji: 'üêü', description: 'Conocidas por sus afilados dientes, las pira√±as se alimentan en grupo de peces e insectos.'},
                { name: 'Orca', type: 'Carn√≠voro', emoji: 'üê≥', description: 'Depredador marino tope, su dieta incluye peces, focas e incluso otras ballenas.'},
                { name: 'Foca', type: 'Carn√≠voro', emoji: 'ü¶≠', description: 'Las focas se alimentan principalmente de peces, calamares y crust√°ceos que capturan bajo el agua.'},
                { name: 'Puma', type: 'Carn√≠voro', emoji: 'üêà‚Äç‚¨õ', description: 'Es un depredador adaptable que caza desde ciervos y alces hasta peque√±os roedores.'},
                { name: 'Nutria', type: 'Carn√≠voro', emoji: 'ü¶¶', description: 'Las nutrias tienen una dieta basada en peces, cangrejos y otros invertebrados acu√°ticos.'},
                { name: 'Drag√≥n de Komodo', type: 'Carn√≠voro', emoji: 'ü¶é', description: 'El lagarto m√°s grande del mundo, caza presas como ciervos, cerdos e incluso b√∫falos.'},
                { name: 'Lince', type: 'Carn√≠voro', emoji: 'üêà', description: 'Este felino solitario se especializa en cazar conejos y liebres.'},
                { name: 'Ping√ºino', type: 'Carn√≠voro', emoji: 'üêß', description: 'Son excelentes nadadores que se alimentan de krill, calamares y peces que cazan en el oc√©ano.'},
                { name: 'Mantis Religiosa', type: 'Carn√≠voro', emoji: 'ü¶ó', description: 'Depredador de emboscada, este insecto se alimenta de otros insectos y ara√±as.'},
                { name: 'Mosquito', type: 'Carn√≠voro', emoji: 'ü¶ü', description: 'Las hembras son carn√≠voras hemat√≥fagas, ya que se alimentan de la sangre de otros animales.'},
                { name: 'Mariquita', type: 'Carn√≠voro', emoji: 'üêû', description: 'Es un importante depredador de pulgones y otros insectos considerados plagas para las plantas.'},
                { name: 'Escorpi√≥n', type: 'Carn√≠voro', emoji: 'ü¶Ç', description: 'Cazador nocturno, se alimenta de insectos, ara√±as y otros escorpiones.'},
                { name: 'Delf√≠n', type: 'Carn√≠voro', emoji: 'üê¨', description: 'Estos mam√≠feros marinos inteligentes cazan en grupo para alimentarse de peces y calamares.'},
                { name: 'Rana', type: 'Carn√≠voro', emoji: 'üê∏', description: 'Se alimentan de insectos, ara√±as y gusanos que capturan con su larga y pegajosa lengua.'},
                { name: 'Murci√©lago', type: 'Carn√≠voro', emoji: 'ü¶á', description: 'Se alimenta de insectos, ara√±as y otros peque√±os artr√≥podos que caza durante la noche.'},
                { name: 'Langosta', type: 'Carn√≠voro', emoji: 'ü¶û', description: 'Se alimenta de peces, cangrejos, almejas y otros animales marinos que encuentra en el fondo.'},
                { name: 'Pulpo', type: 'Carn√≠voro', emoji: 'üêô', description: 'Utiliza sus tent√°culos para atrapar cangrejos, almejas y otros crust√°ceos.'},
                { name: 'Calamar', type: 'Carn√≠voro', emoji: 'ü¶ë', description: 'Se alimenta de peces y crust√°ceos que captura con sus largos tent√°culos.'},
                { name: 'T-Rex', type: 'Carn√≠voro', emoji: 'ü¶ñ', description: 'Fue uno de los carn√≠voros m√°s grandes, aliment√°ndose de otros dinosaurios.'},
                { name: 'Pez Globo', type: 'Carn√≠voro', emoji: 'üê°', description: 'Es principalmente carn√≠voro y se alimenta de invertebrados con caparaz√≥n y algas.'},
                { name: 'Hiena', type: 'Carn√≠voro', emoji: 'üêæ', description: 'Aunque son carro√±eras, tambi√©n son cazadoras eficaces, aliment√°ndose de √±us y cebras.'},
                { name: 'Zorro', type: 'Carn√≠voro', emoji: 'ü¶ä', description: 'Caza principalmente peque√±os roedores, conejos y aves.'},
                { name: 'Halc√≥n', type: 'Carn√≠voro', emoji: 'ü™∂', description: 'Es un ave rapaz que caza otras aves, peque√±os mam√≠feros y reptiles.'},
                
                // Herb√≠voros (33)
                { name: 'Elefante', type: 'Herb√≠voro', emoji: 'üêò', description: 'Es un megaherb√≠voro que consume grandes cantidades de hierbas, cortezas y frutas.'},
                { name: 'Jirafa', type: 'Herb√≠voro', emoji: 'ü¶í', description: 'Gracias a su largo cuello, se especializa en ramonear las hojas y brotes de los √°rboles.'},
                { name: 'Vaca', type: 'Herb√≠voro', emoji: 'üêÑ', description: 'Como rumiante, tiene un sistema digestivo especializado para digerir pastos y forrajes.'},
                { name: 'Conejo', type: 'Herb√≠voro', emoji: 'üêá', description: 'Su dieta se compone de hierbas y tr√©boles. Sus dientes crecen continuamente.'},
                { name: 'Ciervo', type: 'Herb√≠voro', emoji: 'ü¶å', description: 'Son rumiantes que se alimentan de hojas, ramas, hierbas y brotes tiernos.'},
                { name: 'Caballo', type: 'Herb√≠voro', emoji: 'üêé', description: 'Es un animal pastador cuya dieta se basa en heno y pasto.'},
                { name: 'Cebra', type: 'Herb√≠voro', emoji: 'ü¶ì', description: 'Son animales pastadores que se alimentan principalmente de hierbas de baja calidad.'},
                { name: 'Koala', type: 'Herb√≠voro', emoji: 'üê®', description: 'Tiene una dieta muy especializada, aliment√°ndose casi exclusivamente de hojas de eucalipto.'},
                { name: 'Panda', type: 'Herb√≠voro', emoji: 'üêº', description: 'Aunque pertenece al orden de los carn√≠voros, la dieta del panda consiste en un 99% de bamb√∫.'},
                { name: 'Canguro', type: 'Herb√≠voro', emoji: 'ü¶ò', description: 'Son pastadores y se alimentan de una variedad de hierbas.'},
                { name: 'Rinoceronte', type: 'Herb√≠voro', emoji: 'ü¶è', description: 'Dependiendo de la especie, pueden pastar hierba o ramonear hojas y ramas.'},
                { name: 'Gorila', type: 'Herb√≠voro', emoji: 'ü¶ç', description: 'Su dieta se basa en materia vegetal como tallos, hojas y frutas.'},
                { name: 'Loro', type: 'Herb√≠voro', emoji: 'ü¶ú', description: 'Se alimentan principalmente de semillas, frutas, nueces y flores.'},
                { name: 'B√∫falo', type: 'Herb√≠voro', emoji: 'üêÉ', description: 'Es un gran rumiante que se alimenta de hierbas y plantas acu√°ticas.'},
                { name: 'Perezoso', type: 'Herb√≠voro', emoji: 'ü¶•', description: 'Tienen una dieta de muy baja energ√≠a que consiste principalmente en hojas y brotes.'},
                { name: 'Hipop√≥tamo', type: 'Herb√≠voro', emoji: 'ü¶õ', description: 'Salen del agua por la noche para pastar grandes cantidades de hierba.'},
                { name: 'Camello', type: 'Herb√≠voro', emoji: 'üê™', description: 'Est√°n adaptados a comer plantas duras y espinosas del desierto.'},
                { name: 'Oveja', type: 'Herb√≠voro', emoji: 'üêë', description: 'Son rumiantes que pastan hierba y otras plantas bajas.'},
                { name: 'Cabra', type: 'Herb√≠voro', emoji: 'üêê', description: 'Son ramoneadoras, prefiriendo comer hojas, ramas y arbustos.'},
                { name: 'Mariposa', type: 'Herb√≠voro', emoji: 'ü¶ã', description: 'Las mariposas adultas se alimentan del n√©ctar de las flores, mientras que sus orugas comen hojas.'},
                { name: 'Abeja', type: 'Herb√≠voro', emoji: 'üêù', description: 'Recolectan n√©ctar y polen de las flores para alimentar a la colmena.'},
                { name: 'Castor', type: 'Herb√≠voro', emoji: 'ü¶´', description: 'Se alimenta de la corteza, hojas y ramas de los √°rboles que derriba.'},
                { name: 'Llama', type: 'Herb√≠voro', emoji: 'ü¶ô', description: 'Son rumiantes que se alimentan de hierba y plantas de bajo crecimiento.'},
                { name: 'Brontosaurio', type: 'Herb√≠voro', emoji: 'ü¶ï', description: 'Este dinosaurio de cuello largo era un herb√≠voro que com√≠a grandes cantidades de plantas.'},
                { name: 'Caracol', type: 'Herb√≠voro', emoji: 'üêå', description: 'Se alimenta de una gran variedad de plantas, hojas, flores y frutas.'},
                { name: 'Oruga', type: 'Herb√≠voro', emoji: 'üêõ', description: 'En su etapa de larva, es una voraz herb√≠vora que se alimenta de hojas.'},
                { name: 'Pavo Real', type: 'Herb√≠voro', emoji: 'ü¶ö', description: 'Su dieta es principalmente herb√≠vora, basada en p√©talos, semillas y plantas.'},
                { name: 'Colibr√≠', type: 'Herb√≠voro', emoji: 'üê§', description: 'Su dieta se basa casi exclusivamente en el n√©ctar de las flores.'},
                { name: 'Bisonte', type: 'Herb√≠voro', emoji: 'ü¶¨', description: 'Es un gran rumiante que se alimenta pastando en las praderas, principalmente de hierbas.'},
                { name: 'Mamut', type: 'Herb√≠voro', emoji: 'ü¶£', description: 'Era un herb√≠voro que se alimentaba de hierbas y arbustos de la tundra.'},
                { name: 'Puercoesp√≠n', type: 'Herb√≠voro', emoji: 'ü¶î', description: 'Se alimenta de cortezas, ra√≠ces, tallos y hojas. Usa sus p√∫as para defenderse.'},
                { name: 'Carnero', type: 'Herb√≠voro', emoji: 'üêè', description: 'Como rumiante, se alimenta de pastos, hierbas y otras plantas de monta√±a.'},
                { name: 'Tapir', type: 'Herb√≠voro', emoji: 'üêΩ', description: 'Se alimenta de hojas, brotes, ramas y frutas que encuentra en los bosques.'},
                
                // Omn√≠voros (33)
                { name: 'Oso', type: 'Omn√≠voro', emoji: 'üêª', description: 'Su dieta es muy variada: come peces, bayas, ra√≠ces, insectos y peque√±os mam√≠feros.'},
                { name: 'Cerdo', type: 'Omn√≠voro', emoji: 'üêñ', description: 'En la naturaleza, su dieta incluye ra√≠ces, frutas, insectos y peque√±os animales.'},
                { name: 'Mapache', type: 'Omn√≠voro', emoji: 'ü¶ù', description: 'Extremadamente adaptable, come frutas, nueces, insectos, ranas y huevos.'},
                { name: 'Gallina', type: 'Omn√≠voro', emoji: 'üêî', description: 'Picotean semillas y plantas, pero tambi√©n consumen insectos y gusanos.'},
                { name: 'Chimpanc√©', type: 'Omn√≠voro', emoji: 'üêµ', description: 'Aunque su dieta es mayormente vegetariana, tambi√©n cazan para comer carne.'},
                { name: 'Ardilla', type: 'Omn√≠voro', emoji: 'üêøÔ∏è', description: 'Come nueces y semillas, pero no duda en consumir insectos y huevos.'},
                { name: 'Humano', type: 'Omn√≠voro', emoji: 'üßë', description: 'La especie humana consume una amplia variedad de productos vegetales y animales.'},
                { name: 'Tej√≥n', type: 'Omn√≠voro', emoji: 'ü¶°', description: 'Su dieta incluye lombrices, insectos, peque√±os mam√≠feros, frutas y ra√≠ces.'},
                { name: 'Pavo', type: 'Omn√≠voro', emoji: 'ü¶É', description: 'Buscan bellotas y semillas, pero tambi√©n comen insectos y peque√±os reptiles.'},
                { name: 'Pato', type: 'Omn√≠voro', emoji: 'ü¶Ü', description: 'Su dieta var√≠a, pero incluye plantas acu√°ticas, semillas, insectos y caracoles.'},
                { name: 'Orangut√°n', type: 'Omn√≠voro', emoji: 'ü¶ß', description: 'Se alimenta principalmente de frutas y hojas, pero complementa su dieta con insectos.'},
                { name: 'Cuervo', type: 'Omn√≠voro', emoji: 'üê¶‚Äç‚¨õ', description: 'Son aves muy inteligentes con una dieta variada: carro√±a, insectos, semillas y frutas.'},
                { name: 'Rata', type: 'Omn√≠voro', emoji: 'üêÄ', description: 'Son famosas por comer casi cualquier cosa, desde granos y frutas hasta basura.'},
                { name: 'Tortuga', type: 'Omn√≠voro', emoji: 'üê¢', description: 'Dependiendo de la especie, pueden comer algas, medusas, cangrejos y peces.'},
                { name: 'Pez Payaso', type: 'Omn√≠voro', emoji: 'üê†', description: 'Se alimenta de peque√±as algas y de los peque√±os crust√°ceos de su an√©mona.'},
                { name: 'Mofeta', type: 'Omn√≠voro', emoji: 'ü¶®', description: 'Su dieta incluye insectos, larvas, peque√±os roedores, bayas y ra√≠ces.'},
                { name: 'Jabal√≠', type: 'Omn√≠voro', emoji: 'üêó', description: 'Utiliza su hocico para desenterrar ra√≠ces, y tambi√©n come frutas e insectos.'},
                { name: 'Cucaracha', type: 'Omn√≠voro', emoji: 'ü™≥', description: 'Puede comer casi cualquier materia org√°nica, incluyendo papel y restos de comida.'},
                { name: 'Hormiga', type: 'Omn√≠voro', emoji: 'üêú', description: 'Muchas son omn√≠voras y comen n√©ctar, semillas, insectos y restos de animales.'},
                { name: 'Cangrejo', type: 'Omn√≠voro', emoji: 'ü¶Ä', description: 'Son carro√±eros y depredadores que se alimentan de algas, moluscos y restos org√°nicos.'},
                { name: 'Flamenco', type: 'Omn√≠voro', emoji: 'ü¶©', description: 'Filtra peque√±os crust√°ceos y algas, consumiendo materia animal y vegetal.'},
                { name: 'Escarabajo', type: 'Omn√≠voro', emoji: 'ü™≤', description: 'Muchas especies son omn√≠voras y comen plantas, hongos y peque√±os insectos.'},
                { name: 'Perro', type: 'Omn√≠voro', emoji: 'üêï', description: 'Domesticado como omn√≠voro, su dieta incluye carne, granos, frutas y vegetales.'},
                { name: 'Paloma', type: 'Omn√≠voro', emoji: 'üïäÔ∏è', description: 'Se alimenta de semillas y frutas, pero tambi√©n puede comer insectos.'},
                { name: 'Camar√≥n', type: 'Omn√≠voro', emoji: 'ü¶ê', description: 'Es un carro√±ero que se alimenta de algas, plancton y part√≠culas en el agua.'},
                { name: 'Ostra', type: 'Omn√≠voro', emoji: 'ü¶™', description: 'Como animal filtrador, consume plancton y part√≠culas org√°nicas en el agua.'},
                { name: 'Mosca', type: 'Omn√≠voro', emoji: 'ü™∞', description: 'Puede alimentarse de casi cualquier materia org√°nica en descomposici√≥n.'},
                { name: 'Lombriz', type: 'Omn√≠voro', emoji: 'ü™±', description: 'Consume materia org√°nica en descomposici√≥n que incluye restos vegetales y animales.'},
                { name: 'Cisne', type: 'Omn√≠voro', emoji: 'ü¶¢', description: 'Su dieta principal son plantas acu√°ticas, pero ocasionalmente comen insectos y peces.'},
                { name: 'P√°jaro', type: 'Omn√≠voro', emoji: 'üê¶', description: 'Muchas especies de p√°jaros comen tanto semillas y frutas como insectos y gusanos.'},
                { name: 'Em√∫', type: 'Omn√≠voro', emoji: 'ü¶§', description: 'Se alimenta de una gran variedad de plantas e insectos, adapt√°ndose a lo que est√° disponible.'},
                { name: 'H√°mster', type: 'Omn√≠voro', emoji: 'üêπ', description: 'Come semillas y granos, pero tambi√©n puede comer insectos y peque√±os invertebrados.'},
                { name: 'Rat√≥n', type: 'Omn√≠voro', emoji: 'üêÅ', description: 'Es un omn√≠voro oportunista que come semillas, granos e insectos.'}
            ];
            
            const cardBackImages = [
                "https://i.supaimg.com/37ef4026-991a-42e1-afa0-b2db1a21237f.jpg",
                "https://i.supaimg.com/8f73cdcd-f554-4823-914f-947c2cb6c062.jpg"
            ];
            const definitions = [
                'Los <strong class="text-red-500">Carn√≠voros</strong> se alimentan principalmente de carne.',
                'Los <strong class="text-blue-500">Herb√≠voros</strong> consumen plantas y vegetales.',
                'Los <strong class="text-yellow-500">Omn√≠voros</strong> tienen una dieta variada de plantas y animales.'
            ];
            let definitionInterval;
            let currentDefinitionIndex = 0;


            const TOTAL_ANIMALS = animals.length;
            let gameState = {};
            let timer;
            let timeLeft;

            const allScreens = document.querySelectorAll('#app-container > div');
            const startScreen = document.getElementById('start-screen');
            const gameScreen = document.getElementById('game-screen');
            const gradesScreen = document.getElementById('grades-screen');
            const startButton = document.getElementById('start-button');
            const continueButton = document.getElementById('continue-button');
            const gradesButton = document.getElementById('grades-button');
            const backToStartButton = document.getElementById('back-to-start-button');
            const homeButton = document.getElementById('home-button');
            const progressDisplay = document.getElementById('progress-display');
            const timerDisplay = document.getElementById('timer-display');
            const deck = document.getElementById('deck');
            const deckImage = document.getElementById('deck-image');
            const playedCardsStack = document.getElementById('played-cards-stack');
            const currentCardContainer = document.getElementById('current-card-container');
            const cardInnerContainer = document.querySelector('.card-container');
            const cardBack = document.querySelector('.card-back');
            const optionsContainer = document.getElementById('options-container');
            const optionButtons = document.querySelectorAll('.option-button');
            const gradesContent = document.getElementById('grades-content');
            const definitionDisplay = document.getElementById('definition-display');
            const modalOverlay = document.getElementById('modal-overlay');
            const explanationModal = document.getElementById('explanation-modal');
            const understoodButton = document.getElementById('understood-button');
            const feedbackModal = document.getElementById('feedback-modal');
            const feedbackImage = document.getElementById('feedback-image');
            const feedbackTitle = document.getElementById('feedback-title');
            const feedbackText = document.getElementById('feedback-text');
            const feedbackContinueButton = document.getElementById('feedback-continue-button');
            
            function getLocalData() {
                const key = 'animalGameData';
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : { gameState: null, gameHistory: null };
            }

            function setLocalData(data) {
                const key = 'animalGameData';
                localStorage.setItem(key, JSON.stringify(data));
            }

            function showScreen(screenId) {
                allScreens.forEach(screen => screen.classList.add('hidden'));
                modalOverlay.classList.add('hidden');
                document.getElementById(screenId).classList.remove('hidden');
            }

            function saveCurrentProgress() {
                const data = getLocalData();
                setLocalData({ ...data, gameState });
            }
            
            function setupMainMenu() {
                const data = getLocalData();
                const gameInProgress = data.gameState && data.gameState.currentAnimalIndex < data.gameState.shuffledAnimals.length;
                continueButton.classList.toggle('hidden', !gameInProgress);
                
                gradesButton.disabled = !gameInProgress && !data.gameHistory;
                
                showScreen('start-screen');
            }

            function rotateDefinitions() {
                if (definitionDisplay) {
                    definitionDisplay.innerHTML = definitions[currentDefinitionIndex];
                    currentDefinitionIndex = (currentDefinitionIndex + 1) % definitions.length;
                }
            }

            function startGame(isContinuation) {
                const data = getLocalData();
                if (isContinuation && data.gameState) {
                    gameState = data.gameState;
                } else {
                    gameState = {
                        currentAnimalIndex: 0,
                        shuffledAnimals: [...animals].sort(() => Math.random() - 0.5),
                        categoryCorrect: { 'Carn√≠voro': 0, 'Herb√≠voro': 0, 'Omn√≠voro': 0 }
                    };
                    const currentData = getLocalData();
                    delete currentData.gameHistory;
                    setLocalData(currentData);
                }
                showScreen('game-screen');
                updateProgress();
                resetCardState(true);
                clearInterval(definitionInterval); 
                rotateDefinitions(); 
                definitionInterval = setInterval(rotateDefinitions, 8000);
            }

            function drawCard() {
                if (gameState.currentAnimalIndex >= gameState.shuffledAnimals.length) {
                    endGame(); return;
                }
                deck.classList.add('hidden');
                playedCardsStack.classList.remove('hidden');
                const animal = gameState.shuffledAnimals[gameState.currentAnimalIndex];
                const nameClass = animal.name.length > 10 ? 'text-2xl' : 'text-3xl';
                cardBack.innerHTML = `<div class="text-6xl sm:text-8xl mb-4">${animal.emoji}</div><p class="${nameClass} font-black text-gray-800 uppercase">${animal.name}</p>`;
                currentCardContainer.classList.remove('hidden');
                setTimeout(() => cardInnerContainer.classList.add('is-flipped'), 100);
                setTimeout(() => {
                    optionsContainer.classList.remove('opacity-0');
                    optionButtons.forEach(btn => btn.disabled = false);
                    startTimer();
                }, 600);
            }
            
            function startTimer() {
                timeLeft = 10;
                timerDisplay.textContent = timeLeft;
                timerDisplay.classList.remove('timer-warning', 'text-red-600');
                timer = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    if(timeLeft <= 3) timerDisplay.classList.add('timer-warning', 'text-red-600');
                    if (timeLeft === 0) {
                        clearInterval(timer);
                        checkAnswer(null); // Timeout
                    }
                }, 1000);
            }

            function checkAnswer(selectedType) {
                clearInterval(timer);
                optionButtons.forEach(btn => btn.disabled = true);
                
                if (selectedType === null) { // Timeout logic
                    const timedOutAnimal = gameState.shuffledAnimals.splice(gameState.currentAnimalIndex, 1)[0];
                    gameState.shuffledAnimals.push(timedOutAnimal);
                    saveCurrentProgress();
                    
                    deck.classList.add('animate-shake');
                    setTimeout(() => {
                        deck.classList.remove('animate-shake');
                        resetCardState(false);
                    }, 820);
                    return;
                }
                
                const animal = gameState.shuffledAnimals[gameState.currentAnimalIndex];
                const isCorrect = selectedType === animal.type;

                if (isCorrect) {
                    gameState.categoryCorrect[animal.type] = (gameState.categoryCorrect[animal.type] || 0) + 1;
                    document.body.style.boxShadow = 'inset 0 0 0 15px #16a34a';
                    setTimeout(() => { document.body.style.boxShadow = 'none'; }, 400);
                    setTimeout(continueGame, 500);
                } else {
                    showFeedbackModal();
                }
            }
            
            function showFeedbackModal() {
                const animal = gameState.shuffledAnimals[gameState.currentAnimalIndex];
                feedbackImage.innerHTML = animal.emoji;
                feedbackTitle.textContent = `Incorrecto. Era ${animal.type}.`;
                feedbackTitle.className = `text-3xl font-black mb-2 text-red-600`;
                feedbackText.textContent = animal.description;
                
                modalOverlay.classList.remove('hidden');
                explanationModal.classList.add('hidden');
                feedbackModal.classList.remove('hidden');
            }

            function continueGame() {
                 modalOverlay.classList.add('hidden');
                 feedbackModal.classList.add('hidden');
                 
                 gameState.currentAnimalIndex++;
                 saveCurrentProgress();

                 updateProgress();
                 resetCardState(false);
            }
            
            function resetCardState(isFirstCard) {
                 cardInnerContainer.classList.remove('is-flipped');
                 optionsContainer.classList.add('opacity-0');

                 const nextImageIndex = gameState.currentAnimalIndex % cardBackImages.length;
                 deckImage.src = cardBackImages[nextImageIndex];

                 setTimeout(() => {
                    currentCardContainer.classList.add('hidden');
                    if(!isFirstCard) playedCardsStack.classList.add('hidden');
                    
                    if (gameState.currentAnimalIndex >= gameState.shuffledAnimals.length) endGame();
                    else {
                        if (isFirstCard) drawCard();
                        else deck.classList.remove('hidden');
                    }
                 }, 400);
            }
            
            function updateProgress() {
                const progress = gameState.currentAnimalIndex + 1;
                const total = gameState.shuffledAnimals.length;
                progressDisplay.textContent = `${progress > total ? total : progress}/${total}`;
            }

            function endGame() {
                clearInterval(definitionInterval); 
                const { categoryCorrect } = gameState;
                const totalCorrect = Object.values(categoryCorrect).reduce((a, b) => a + b, 0);
                const getAccuracy = (correct, total) => total > 0 ? Math.round((correct / total) * 100) : 0;
                
                const carnivoreTotal = animals.filter(a => a.type === 'Carn√≠voro').length;
                const herbivoreTotal = animals.filter(a => a.type === 'Herb√≠voro').length;
                const omnivoreTotal = animals.filter(a => a.type === 'Omn√≠voro').length;

                const gameHistory = {
                    general: getAccuracy(totalCorrect, TOTAL_ANIMALS),
                    carnivore: getAccuracy(categoryCorrect['Carn√≠voro'] || 0, carnivoreTotal),
                    herbivore: getAccuracy(categoryCorrect['Herb√≠voro'] || 0, herbivoreTotal),
                    omnivore: getAccuracy(categoryCorrect['Omn√≠voro'] || 0, omnivoreTotal)
                };
                setLocalData({ gameState: null, gameHistory });
                showGrades();
            }

            function showGrades() {
                const { gameState, gameHistory } = getLocalData();
                document.querySelector('#grades-screen h2').textContent = `Reporte de Calificaci√≥n`;

                let statsToShow = null;
                let isFinal = false;
                let progressText = '';

                if (gameHistory) {
                    statsToShow = gameHistory;
                    isFinal = true;
                } else if (gameState && gameState.currentAnimalIndex > 0) {
                    const { categoryCorrect, shuffledAnimals, currentAnimalIndex } = gameState;
                    const totalCorrect = Object.values(categoryCorrect).reduce((a, b) => a + b, 0);
                    
                    const animalsAnswered = shuffledAnimals.slice(0, currentAnimalIndex);
                    const totalAnswered = animalsAnswered.length;

                    const carnivoresAnswered = animalsAnswered.filter(a => a.type === 'Carn√≠voro').length;
                    const herbivoresAnswered = animalsAnswered.filter(a => a.type === 'Herb√≠voro').length;
                    const omnivoresAnswered = animalsAnswered.filter(a => a.type === 'Omn√≠voro').length;

                    const getAccuracy = (correct, total) => total > 0 ? Math.round((correct / total) * 100) : 0;

                    statsToShow = {
                        general: getAccuracy(totalCorrect, totalAnswered),
                        carnivore: getAccuracy(categoryCorrect['Carn√≠voro'] || 0, carnivoresAnswered),
                        herbivore: getAccuracy(categoryCorrect['Herb√≠voro'] || 0, herbivoresAnswered),
                        omnivore: getAccuracy(categoryCorrect['Omn√≠voro'] || 0, omnivoresAnswered)
                    };
                    progressText = ` (${totalAnswered}/${TOTAL_ANIMALS} respondidas)`;
                }

                if (!statsToShow) {
                    gradesContent.innerHTML = `<div class="text-center py-8 px-4 col-span-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                        </svg>
                        <h3 class="mt-4 text-xl font-bold text-gray-800">No hay datos para mostrar</h3>
                        <p class="mt-2 text-gray-600">Completa tu primera partida para ver tus calificaciones aqu√≠.</p>
                    </div>`;
                } else {
                     const renderScore = (label, score) => {
                        const pass = score >= 65;
                        const color = pass ? 'green' : 'red';
                        const status = pass ? 'APROBADO' : 'MEJORABLE';
                        return `<div class="bg-gray-100 p-4 rounded-lg"><div class="flex justify-between items-center"><span class="font-bold text-gray-700 text-lg">${label}</span><span class="font-black text-2xl text-${color}-600">${score}%</span></div><div class="w-full bg-gray-300 rounded-full h-4 mt-2"><div class="bg-${color}-500 h-4 rounded-full" style="width: ${score}%"></div></div><p class="text-right font-bold text-sm mt-1 text-${color}-600">${status}</p></div>`;
                    };
                    const title = isFinal ? 'Calificaci√≥n General' : 'Progreso General';
                    gradesContent.innerHTML = `
                        ${renderScore(title + progressText, statsToShow.general)}
                        ${renderScore('Precisi√≥n con Carn√≠voros', statsToShow.carnivore)}
                        ${renderScore('Precisi√≥n con Herb√≠voros', statsToShow.herbivore)}
                        ${renderScore('Precisi√≥n con Omn√≠voros', statsToShow.omnivore)}
                    `;
                }
                showScreen('grades-screen');
            }
            
            function init() {
                explanationModal.classList.remove('hidden');
                modalOverlay.classList.remove('hidden');
                feedbackModal.classList.add('hidden');
            }

            understoodButton.addEventListener('click', () => {
                explanationModal.classList.add('hidden');
                modalOverlay.classList.add('hidden');
                setupMainMenu();
            });
            
            startButton.addEventListener('click', () => startGame(false));
            continueButton.addEventListener('click', () => startGame(true));
            gradesButton.addEventListener('click', showGrades);
            backToStartButton.addEventListener('click', () => setupMainMenu());
            homeButton.addEventListener('click', () => {
                clearInterval(timer);
                clearInterval(definitionInterval); 
                saveCurrentProgress();
                setupMainMenu();
            });
            deck.addEventListener('click', drawCard);
            optionButtons.forEach(button => button.addEventListener('click', () => checkAnswer(button.dataset.type)));
            feedbackContinueButton.addEventListener('click', continueGame);

            init();
        });
    </script>
</body>
</html>

